C51 COMPILER V9.53.0.0   MAIN                                                              04/17/2021 20:22:52 PAGE 1   


C51 COMPILER V9.53.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\keil5-MDK\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\ma
                    -in.lst) OBJECT(.\Objects\main.obj)

line level    source

   1          //https://github.com/CoreSic/Lqb-IAP15
   2          //项目名称：蓝桥杯大赛-单片机组demo
   3          //作者：coresic
   4          //转载请注明出处
   5          
   6          #include <STC15F2K60S2.H>
   7          #include "onewire.h"
   8          #include "ds1302.h"
   9          #include "iic.h"
  10          
  11          #define uchar unsigned char
  12          #define uint unsigned int
  13                  
  14          uchar WEI[8];//数码管显示值缓存
  15          uchar DUAN[10]={0xc0,0xf9,0xa4,0xb0,0x99,0x92,0x82,0xf8,0x80,0x90};//数码管段码
  16          uchar index;//数码管显示位置
  17          float wendu;//温度数据
  18          uint count;//定时器计数值
  19          uchar hour, minute, second;//时分秒
  20          uchar ADC_data;//ADC数据
  21          
  22          void Enable38(uchar num)//38译码器
  23          {
  24   1              P2&=0x1f;
  25   1              P2|=num<<5;
  26   1      }
  27          
  28          void Timer0_Init()//定时器0初始化
  29          {
  30   1              TMOD=0x01;
  31   1              TH0=-9;
  32   1              TL1=0;
  33   1              TR0=1;
  34   1              ET0=1;
  35   1              EA=1;
  36   1      }
  37          
  38          void Display_init()//数码管显示初始化
  39          {
  40   1              WEI[0]=DUAN[0];
  41   1              WEI[1]=DUAN[0];
  42   1              WEI[2]=DUAN[0];
  43   1              WEI[3]=DUAN[0];
  44   1              WEI[4]=DUAN[0];
  45   1              WEI[5]=DUAN[0];
  46   1              WEI[6]=DUAN[0];
  47   1              WEI[7]=DUAN[0];
  48   1      }
  49          
  50          void Display_wendu()//温度显示
  51          {
  52   1              uint wendu_num=wendu*10;
  53   1              WEI[0]=DUAN[wendu_num/100];
  54   1              WEI[1]=DUAN[wendu_num/10%10]&0x7f;
C51 COMPILER V9.53.0.0   MAIN                                                              04/17/2021 20:22:52 PAGE 2   

  55   1              WEI[2]=DUAN[wendu_num%10];
  56   1      }
  57          
  58          void Display_date()//时间显示
  59          {
  60   1              second=Read_Ds1302_Byte(0x81);//读取秒
  61   1              minute=Read_Ds1302_Byte(0x83);//读取分
  62   1              hour=Read_Ds1302_Byte(0x85);//读取时
  63   1              
  64   1              WEI[0]=DUAN[hour/10];
  65   1              WEI[1]=DUAN[hour%10];
  66   1              
  67   1              WEI[2]=~0x40;
  68   1              
  69   1              WEI[3]=DUAN[minute/10];
  70   1              WEI[4]=DUAN[minute%10];
  71   1              
  72   1              WEI[5]=~0x40;
  73   1              
  74   1              WEI[6]=DUAN[second/10];
  75   1              WEI[7]=DUAN[second%10];
  76   1      }
  77          
  78          void Display_ADC(unsigned char address_ADC)
  79          {
  80   1              ADC_data=PCF8591_Get_ADC(address_ADC);
  81   1              WEI[0]=DUAN[ADC_data/100];
  82   1              WEI[1]=DUAN[ADC_data/10%10];
  83   1              WEI[2]=DUAN[ADC_data%10];
  84   1              WEI[3]=0xff;
  85   1              WEI[4]=0xff;
  86   1              WEI[5]=0xff;
  87   1              WEI[6]=0xff;
  88   1              WEI[7]=0xff;
  89   1      }
  90          
  91          void Display_AT24C02(unsigned char num)
  92          {
  93   1              WEI[0]=DUAN[num/100];
  94   1              WEI[1]=DUAN[num/10%10];
  95   1              WEI[2]=DUAN[num%10];
  96   1              WEI[3]=0xff;
  97   1              WEI[4]=0xff;
  98   1              WEI[5]=0xff;
  99   1              WEI[6]=0xff;
 100   1              WEI[7]=0xff;
 101   1      }
 102          
 103          void Display()//数码管显示
 104          {
 105   1              Enable38(6);
 106   1              P0=(0x01<<index);
 107   1              Enable38(7);
 108   1              P0=(WEI[index]);
 109   1              index++;
 110   1              index&=7;
 111   1      }
 112          
 113          void LED8_ON(uchar num)//流水灯开
 114          {
 115   1              Enable38(4);
 116   1              if(num<=7)
C51 COMPILER V9.53.0.0   MAIN                                                              04/17/2021 20:22:52 PAGE 3   

 117   1              P0&=~(0x01<<num);
 118   1              else
 119   1              P0=0X00;
 120   1      }
 121          
 122          void LED8_OFF(uchar num)//流水灯关
 123          {
 124   1              Enable38(4);
 125   1              if(num<=7)
 126   1              P0|=0x01<<num;
 127   1              else
 128   1              P0=0Xff;
 129   1      }
 130          
 131          void main()//主函数
 132          {
 133   1              float temp_num;
 134   1              Display_init();//数码管显示初始化
 135   1              Timer0_Init();//定时器0初始化
 136   1              Init_DS1302();//DS1302初始化
 137   1              LED8_OFF(8);//关闭8个led
 138   1              AT24C02_write(0x03,60);
 139   1      //      adc_set(0);
 140   1              Display_AT24C02(AT24C02_read(0x03));
 141   1              Display_AT24C02(AT24C02_read(0x03));//重复一次，保证读取成功率
 142   1              while(1)
 143   1              {
 144   2                      
 145   2                      if(count>=100)
 146   2                      {
 147   3                              count=0;
 148   3                              
 149   3      //                      Display_ADC(0x01);//ADC数据显示
 150   3                              
 151   3      //                      Display_date();//时间显示
 152   3                              
 153   3      //                      temp_num=Ds18b20_Get_data();//获取温度值
 154   3      //                      if(temp_num<30)
 155   3      //                      wendu=temp_num;//更新温度值
 156   3      //                      Display_wendu();//更新温度显示
 157   3                      }
 158   2                      
 159   2                      
 160   2              }
 161   1      }
*** WARNING C280 IN LINE 133 OF main.c: 'temp_num': unreferenced local variable
 162          
 163          void Timer0() interrupt 1//定时器0中断
 164          {
 165   1              TH0=-9;
 166   1              count++;
 167   1              Display();//数码管显示函数
 168   1      }
 169          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    564    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     29       4
C51 COMPILER V9.53.0.0   MAIN                                                              04/17/2021 20:22:52 PAGE 4   

   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
